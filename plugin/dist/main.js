(()=>{chrome.storage.local;let e=0,t={};chrome.storage.local.set({key:{hey:"hello"}}).then((()=>{console.log("Value is set to "+JSON.stringify(t))}));const o=e=>{let t=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0];return t=t.split(":")[0],t=t.split("?")[0],t},n=async(o,n)=>{e+=n;const s=o in t?parseInt(t[o]):0;t[o]=s+n,chrome.storage.local.set({stats:{hey:"hello"}}).then((()=>{console.log("Value is set to "+JSON.stringify(t))}))},s=e=>{if("undefined"==typeof browser){const t=o(e.initiator?e.initiator:e.url),s=e.responseHeaders.find((e=>"content-length"===e.name.toLowerCase())),r=parseInt((void 0===s?{value:0}:s).value,10);return n(t,r),{}}let t=browser.webRequest.filterResponseData(e.requestId);return t.ondata=s=>{const r=o(e.originUrl?e.originUrl:e.url);n(r,s.data.byteLength),console.log("event",s),t.write(s.data)},t.onstop=()=>{t.disconnect()},{}},r=async()=>{};let l;chrome.runtime.onConnect.addListener((function(e){e.onDisconnect.addListener((function(){(()=>{const e=JSON.stringify(t);console.log("disconnected"),chrome.storage.local.set({stats:e}).then((()=>{console.log("Value is set to "+e)}))})()}))})),(e=>{if("start"===(e={action:"start"}).action)return console.log("start"),chrome.webRequest.onHeadersReceived.addListener(s,{urls:["<all_urls>"]},["responseHeaders"]),void(l||(l=setInterval(r,6e4)));"stop"===e.action&&(chrome.webRequest.onHeadersReceived.removeListener(s),l&&(clearInterval(l),l=null))})({action:"start"}),(async()=>{try{const e=await fetch("http://localhost:3000"),t=await e.json();console.log("intensity",t),document.getElementById("carbon_intensity").textContent=t}catch(e){return console.log("couldn't fetch from backend"),0}})()})();