(()=>{"use strict";let e,t,n=0,o=new Map;const s=e=>{let t=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0];return t=t.split(":")[0],t=t.split("?")[0],t},r=()=>{chrome.storage.sync.set({storageKey:JSON.stringify([...o])}).then((()=>{console.log("Set storageKey: "+JSON.stringify([...o]))}));try{document.getElementById("bytes_used").textContent=n/1024,e||(e=document.getElementById("reset_button"),e.onclick=()=>(console.log("reset"),n=0,void chrome.storage.sync.set({storageKey:JSON.stringify(new Map)}).then((()=>{console.log("Set storageKey: "+JSON.stringify(new Map))})))),t=document.getElementById("read_more_button"),t.onclick=()=>chrome.tabs.create({url:chrome.runtime.getURL("readmore.html")})}catch(e){console.log("document not defined")}},i=e=>{if("undefined"==typeof browser){const t=s(e.initiator?e.initiator:e.url),n=e.responseHeaders.find((e=>"content-length"===e.name.toLowerCase()))||{value:0};if(n.value>0){const e={size:parseInt(n.value,10),origin:t};o.set(t,e)}return{}}let t=browser.webRequest.filterResponseData(e.requestId);return t.ondata=e=>{t.write(e.data)},t.onstop=()=>{t.disconnect()},{}};let a;chrome.webRequest.onResponseStarted.addListener((({ip:e,...t})=>{const n=s(t.initiator?t.initiator:t.url),r=o.get(n);r&&(r.ip=e,o.set(n,r)),console.log(`Network request with ${e}`),console.table("request",t.requestId)}),{urls:["*://*/*"]}),chrome.storage.sync.get(["energy_usage_map"]).then((e=>{e.storageKey&&"[]"!=e.storageKey&&(console.log("result.storageKey",e.storageKey),o=new Map(JSON.parse(e.storageKey)));const t=(n=[],(s=new(window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection)({iceServers:[]})).createDataChannel(""),s.onicecandidate=function(e){if(e.candidate){var t=/^candidate:.+ (\S+) \d+ typ/.exec(e.candidate.candidate)[1];-1==n.indexOf(t)&&n.push(t)}else s.close()},s.createOffer((function(e){s.setLocalDescription(e)}),(function(){})),n);var n,s;console.log("localIps",t),chrome.webRequest.onHeadersReceived.addListener(i,{urls:["<all_urls>"]},["responseHeaders"]),a=setTimeout(r,1e3)})),chrome.system.network.getNetworkInterfaces((function(e){console.log("interfaces",e)})),chrome.runtime.onSuspend.addListener(clearTimeout(a))})();